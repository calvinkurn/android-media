package com.tokopedia.checkout.domain.usecase

import com.google.gson.Gson
import com.tokopedia.abstraction.common.di.qualifier.ApplicationContext
import com.tokopedia.checkout.data.model.response.shipmentaddressform.ShipmentAddressFormDataResponse
import com.tokopedia.checkout.data.model.response.shipmentaddressform.ShipmentAddressFormGqlResponse
import com.tokopedia.checkout.domain.mapper.ShipmentMapper
import com.tokopedia.checkout.domain.model.cartshipmentform.CartShipmentAddressFormData
import com.tokopedia.gql_query_annotation.GqlQuery
import com.tokopedia.graphql.coroutines.data.extensions.getSuccessData
import com.tokopedia.graphql.coroutines.domain.repository.GraphqlRepository
import com.tokopedia.graphql.data.model.GraphqlRequest
import com.tokopedia.kotlin.extensions.view.toIntOrZero
import com.tokopedia.localizationchooseaddress.common.ChosenAddressRequestHelper
import com.tokopedia.purchase_platform.common.constant.CartConstant
import com.tokopedia.purchase_platform.common.exception.CartResponseErrorException
import com.tokopedia.usecase.coroutines.UseCase
import timber.log.Timber
import javax.inject.Inject

class GetShipmentAddressFormV3UseCase @Inject constructor(@ApplicationContext private val graphqlRepository: GraphqlRepository,
                                                          private val shipmentMapper: ShipmentMapper,
                                                          private val chosenAddressRequestHelper: ChosenAddressRequestHelper) : UseCase<CartShipmentAddressFormData>() {

    private var params: Map<String, Any?>? = null

    fun setParams(isOneClickShipment: Boolean,
                  isTradeIn: Boolean,
                  isSkipUpdateOnboardingState: Boolean,
                  cornerId: String?,
                  deviceId: String?,
                  leasingId: String?) {
        val params: MutableMap<String, Any?> = HashMap()
        params[ChosenAddressRequestHelper.KEY_CHOSEN_ADDRESS] = chosenAddressRequestHelper.getChosenAddress()
        params[PARAM_KEY_LANG] = "id"
        params[PARAM_KEY_IS_ONE_CLICK_SHIPMENT] = isOneClickShipment
        params[PARAM_KEY_SKIP_ONBOARDING_UPDATE_STATE] = if (isSkipUpdateOnboardingState) 1 else 0
        if (cornerId != null) {
            try {
                val tmpCornerId = cornerId.toIntOrZero()
                params[PARAM_KEY_CORNER_ID] = tmpCornerId
            } catch (e: NumberFormatException) {
                Timber.d(e)
            }
        }
        if (leasingId != null && !leasingId.isEmpty()) {
            try {
                val tmpLeasingId = leasingId.toIntOrZero()
                params[PARAM_KEY_VEHICLE_LEASING_ID] = tmpLeasingId
            } catch (e: NumberFormatException) {
                Timber.d(e)
            }
        }
        if (isTradeIn) {
            params[PARAM_KEY_IS_TRADEIN] = true
            params[PARAM_KEY_DEVICE_ID] = deviceId ?: ""
        }

        this.params = mapOf(
                "params" to params
        )
    }

    @GqlQuery(QUERY_SHIPMENT_ADDRESS_FORM, SHIPMENT_ADDRESS_FORM_V3_QUERY)
    override suspend fun executeOnBackground(): CartShipmentAddressFormData {
        if (params == null) {
            throw RuntimeException("Parameter is null!")
        }

        val request = GraphqlRequest(ShipmentAddressFormQuery(), ShipmentAddressFormGqlResponse::class.java, params)
        val response = graphqlRepository.response(listOf(request)).getSuccessData<ShipmentAddressFormGqlResponse>()

        if (response.shipmentAddressFormResponse.status == "OK") {
            val dummy = Gson().fromJson("{\"errors\":[],\"error_code\":0,\"kero_token\":\"Tokopedia+Kero:SbcdX1R2tpL2l5sTUFEzdRENjMA=\",\"kero_discom_token\":\"Tokopedia+Kero:vIw7BPFbLjTolGiyTkkxweDTc4k=\",\"kero_unix_time\":1664272829,\"is_robinhood\":1,\"is_hide_courier_name\":false,\"is_show_onboarding\":false,\"is_ineligible_promo_dialog_enabled\":true,\"disabled_features\":[],\"donation_checkbox_status\":false,\"image_upload\":{\"show_image_upload\":false,\"text\":\"\",\"left_icon_url\":\"\",\"right_icon_url\":\"\",\"checkout_id\":\"\",\"front_end_validation\":false},\"open_prerequisite_site\":false,\"eligible_new_shipping_experience\":true,\"pop_up_message\":\"\",\"pop_up\":{\"title\":\"\",\"description\":\"\",\"button\":{\"text\":\"\"}},\"error_ticker\":\"\",\"group_address\":[{\"errors\":[],\"user_address\":{\"address_id\":193890273,\"address_name\":\"Rumah\",\"address\":\"medan amplas, kota medan\",\"postal_code\":\"20229\",\"phone\":\"6285813484454\",\"receiver_name\":\"ilyas buyer testing\",\"status\":1,\"country\":\"Indonesia\",\"province_id\":2,\"province_name\":\"Sumatera Utara\",\"city_id\":46,\"city_name\":\"Kota Medan\",\"district_id\":577,\"district_name\":\"Medan Amplas\",\"address_2\":\"3.546242,98.71921\",\"latitude\":\"3.546242\",\"longitude\":\"98.71921\",\"corner_id\":0,\"is_corner\":false,\"state\":101,\"state_detail\":\"chosen_address_match\",\"tokonow\":{\"is_modified\":false,\"shop_id\":11515028,\"warehouse_id\":0,\"warehouses\":[{\"warehouse_id\":0,\"service_type\":\"2h\"},{\"warehouse_id\":0,\"service_type\":\"15m\"}],\"service_type\":\"ooc\"}},\"group_shop\":[{\"add_ons\":{\"status\":0,\"add_on_data\":[],\"add_on_button\":{\"title\":\"\",\"description\":\"\",\"left_icon_url\":\"\",\"right_icon_url\":\"\",\"action\":0},\"add_on_bottomsheet\":{\"header_title\":\"\",\"description\":\"\",\"products\":[],\"ticker\":{\"text\":\"\"}}},\"errors\":[],\"errors_unblocking\":[],\"shipping_id\":23,\"sp_id\":55,\"bo_code\":\"BOINTERECISLANDQA50\",\"is_insurance\":false,\"is_fulfillment_service\":false,\"toko_cabang\":{\"message\":\"Dilayani Tokopedia\",\"badge_url\":\"https://images.tokopedia.net/img/restriction-engine/bebas-ongkir/DilayaniTokopedia_Icon.png\"},\"cart_string\":\"14000642-0-13883536-193890273\",\"has_promo_list\":false,\"shipment_information\":{\"shop_location\":\"Jakarta Selatan\",\"estimation\":\"\",\"free_shipping\":{\"eligible\":true,\"badge_url\":\"https://images.tokopedia.net/img/img/promo/targeting/red_bo_normal.png\"},\"free_shipping_extra\":{\"eligible\":false,\"badge_url\":\"\"},\"free_shipping_general\":{\"bo_name\":\"bebas ongkir\",\"bo_type\":1,\"badge_url\":\"https://images.tokopedia.net/img/img/promo/targeting/red_bo_normal.png\"},\"preorder\":{\"is_preorder\":false,\"duration\":\"\"}},\"is_disable_change_courier\":false,\"auto_courier_selection\":false,\"courier_selection_error\":{\"title\":\"\",\"description\":\"\"},\"bo_metadata\":{\"bo_type\":1,\"bo_eligibilities\":[{\"key\":\"is_bo_reg\",\"value\":\"true\"},{\"key\":\"bo_type\",\"value\":\"1\"},{\"key\":\"campaign_ids\",\"value\":\"21,22,23,32\"}]},\"save_state_flag\":false,\"promo_codes\":[\"BOINTERECISLANDQA50\"],\"vehicle_leasing\":{\"booking_fee\":0,\"is_leasing_product\":false},\"shop\":{\"shop_id\":14000642,\"shop_name\":\"s3ll3r-sh0p-01\",\"shop_image\":\"https://images.tokopedia.net/img/seller_no_logo_2.png\",\"shop_url\":\"https://www.tokopedia.com/s3ll3r-sh0p-01\",\"shop_status\":1,\"postal_code\":\"12240\",\"latitude\":\"-6.23660000000001\",\"longitude\":\"106.78058999999996\",\"district_id\":2265,\"district_name\":\"Kebayoran Lama\",\"origin\":2265,\"address_street\":\", Kebayoran Lama Utara, Kecamatan Kebayoran Lama, 12240\",\"province_id\":13,\"city_id\":175,\"city_name\":\"Jakarta Selatan\",\"shop_alert_message\":\"\",\"is_tokonow\":false,\"is_gold\":1,\"is_official\":1,\"shop_ticker\":\"\",\"shop_ticker_title\":\"\",\"shop_type_info\":{\"shop_tier\":2,\"shop_grade\":0,\"badge\":\"https://images.tokopedia.net/img/official_store/badge_os.png\",\"badge_svg\":\"https://images.tokopedia.net/img/official_store/badge_official.svg\",\"title\":\"Official Store\"}},\"shop_shipments\":[{\"ship_id\":1,\"ship_name\":\"JNE\",\"ship_code\":\"jne\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-jne.png\",\"is_dropship_enabled\":1,\"ship_prods\":[{\"ship_prod_id\":1,\"ship_prod_name\":\"Reguler\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":2,\"ship_prod_name\":\"OKE\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":6,\"ship_prod_name\":\"YES\",\"ship_group_name\":\"nextday\",\"ship_group_id\":1003,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":22,\"ship_prod_name\":\"JNE Trucking\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0}]},{\"ship_id\":4,\"ship_name\":\"Pos Indonesia\",\"ship_code\":\"pos\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-pos.png\",\"is_dropship_enabled\":1,\"ship_prods\":[{\"ship_prod_id\":10,\"ship_prod_name\":\"Pos Kilat Khusus\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0}]},{\"ship_id\":6,\"ship_name\":\"Wahana\",\"ship_code\":\"wahana\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-wahana.png\",\"is_dropship_enabled\":1,\"ship_prods\":[{\"ship_prod_id\":8,\"ship_prod_name\":\"Service Normal\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0}]},{\"ship_id\":10,\"ship_name\":\"GoSend\",\"ship_code\":\"gojek\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-gosend.png\",\"is_dropship_enabled\":0,\"ship_prods\":[{\"ship_prod_id\":20,\"ship_prod_name\":\"Same Day\",\"ship_group_name\":\"sameday\",\"ship_group_id\":1002,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":28,\"ship_prod_name\":\"Instant Courier\",\"ship_group_name\":\"instant\",\"ship_group_id\":1000,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":59,\"ship_prod_name\":\"Instant Car\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0}]},{\"ship_id\":11,\"ship_name\":\"SiCepat\",\"ship_code\":\"sicepat\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-sicepat.png\",\"is_dropship_enabled\":1,\"ship_prods\":[{\"ship_prod_id\":51,\"ship_prod_name\":\"HALU\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":43,\"ship_prod_name\":\"GOKIL\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":44,\"ship_prod_name\":\"Regular Package\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":18,\"ship_prod_name\":\"Regular Package\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":33,\"ship_prod_name\":\"BEST\",\"ship_group_name\":\"nextday\",\"ship_group_id\":1003,\"additional_fee\":0,\"minimum_weight\":0}]},{\"ship_id\":13,\"ship_name\":\"GrabExpress\",\"ship_code\":\"grab\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-grab.png\",\"is_dropship_enabled\":0,\"ship_prods\":[{\"ship_prod_id\":37,\"ship_prod_name\":\"Instant\",\"ship_group_name\":\"instant\",\"ship_group_id\":1000,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":24,\"ship_prod_name\":\"Same Day\",\"ship_group_name\":\"sameday\",\"ship_group_id\":1002,\"additional_fee\":0,\"minimum_weight\":0}]},{\"ship_id\":23,\"ship_name\":\"AnterAja\",\"ship_code\":\"anteraja\",\"ship_logo\":\"https://ecs7.tokopedia.net/img/kurir-anteraja.png\",\"is_dropship_enabled\":1,\"ship_prods\":[{\"ship_prod_id\":55,\"ship_prod_name\":\"Economy\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":56,\"ship_prod_name\":\"Cargo\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":49,\"ship_prod_name\":\"Same Day\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":46,\"ship_prod_name\":\"Next Day\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0},{\"ship_prod_id\":45,\"ship_prod_name\":\"Reguler\",\"ship_group_name\":\"regular\",\"ship_group_id\":1004,\"additional_fee\":0,\"minimum_weight\":0}]}],\"dropshipper\":{\"name\":\"\",\"telp_no\":\"\"},\"cart_details\":[{\"errors\":[],\"bundle_detail\":{\"bundle_description\":\"\",\"bundle_group_id\":\"\",\"bundle_id\":0,\"bundle_max_order\":0,\"bundle_min_order\":0,\"bundle_name\":\"\",\"bundle_original_price\":0,\"bundle_original_price_fmt\":\"\",\"bundle_price\":0,\"bundle_price_fmt\":\"\",\"bundle_qty\":0,\"bundle_quota\":0,\"bundle_status\":\"\",\"bundle_type\":\"\",\"slash_price_label\":\"\",\"bundle_icon_url\":\"\"},\"products\":[{\"add_ons\":{\"status\":0,\"add_on_data\":[],\"add_on_button\":{\"title\":\"\",\"description\":\"\",\"left_icon_url\":\"\",\"right_icon_url\":\"\",\"action\":0},\"add_on_bottomsheet\":{\"header_title\":\"\",\"description\":\"\",\"products\":[],\"ticker\":{\"text\":\"\"}}},\"errors\":[],\"cart_id\":\"5361842981\",\"product_id\":4411133958,\"product_name\":\"S3patu Ol4hraga\",\"product_price_fmt\":\"Rp72.000\",\"product_price\":72000,\"product_original_price\":90000,\"product_wholesale_price\":72000,\"product_wholesale_price_fmt\":\"Rp72.000\",\"product_weight_fmt\":\"200gr\",\"product_weight\":200,\"product_weight_actual\":200,\"product_condition\":1,\"product_url\":\"https://www.tokopedia.com/s3ll3r-sh0p-01/s3patu-ol4hraga\",\"product_returnable\":0,\"product_is_free_returns\":0,\"product_is_preorder\":0,\"product_cashback\":\"\",\"product_min_order\":1,\"product_invenage_value\":100,\"product_switch_invenage\":1,\"product_price_currency\":1,\"product_image_src_200_square\":\"https://ecs7.tokopedia.net/img/cache/200-square/VqbcmM/2022/6/21/55fca06a-f216-4368-ad49-f86af9767354.jpg\",\"product_notes\":\"\",\"product_quantity\":1,\"product_menu_id\":0,\"product_finsurance\":0,\"product_fcancel_partial\":0,\"product_cat_id\":1809,\"product_catalog_id\":0,\"product_category\":\"Fashion Pria / Atasan Pria / Kaos Polo Pria\",\"purchase_protection_plan_data\":{\"protection_available\":true,\"protection_type_id\":2304,\"protection_price_per_product\":5200,\"protection_price\":5200,\"protection_title\":\"Rusak total selama dipakai? Bisa ganti rugi!\",\"protection_subtitle\":\"Proses klaim mudah dan instan, berlaku 3 bulan\",\"protection_link_text\":\"Pelajari\",\"protection_link_url\":\"https://www.tokopedia.com/asuransi/proteksi/kerusakan-total/\",\"protection_opt_in\":false,\"protection_checkbox_disabled\":false},\"product_variants\":{\"parent_id\":0},\"product_tracker_data\":{\"attribution\":\"none/other\",\"tracker_list_name\":\"none/other\"},\"product_preorder\":{\"duration_text\":\"\",\"duration_day\":\"0\"},\"trade_in_info\":{\"is_valid_trade_in\":false,\"new_device_price\":0,\"new_device_price_fmt\":\"\",\"old_device_price\":0,\"old_device_price_fmt\":\"\",\"drop_off_enable\":false,\"device_model\":\"\",\"diagnostic_id\":0},\"free_shipping\":{\"eligible\":true,\"badge_url\":\"https://images.tokopedia.net/img/img/promo/targeting/red_bo_normal.png\"},\"free_shipping_extra\":{\"eligible\":false,\"badge_url\":\"\"},\"free_shipping_general\":{\"bo_name\":\"bebas ongkir\",\"bo_type\":1,\"badge_url\":\"https://images.tokopedia.net/img/img/promo/targeting/red_bo_normal.png\"},\"product_ticker\":{\"show_ticker\":false,\"message\":\"\"},\"variant_description_detail\":{\"variant_name\":[],\"variant_description\":\"\"},\"product_alert_message\":\"\",\"product_information\":[],\"campaign_id\":1220792,\"ethical_drug\":{\"need_prescription\":false,\"icon_url\":\"https://images.tokopedia.net/img/cartapp/icons/ethical_drug.png\",\"text\":\"Butuh Resep\"}}]}],\"warehouse\":{\"warehouse_id\":13883536,\"city_name\":\"Jakarta Selatan\"}}]}],\"donation\":{\"Title\":\"Donasi Rp5.000 untuk Pemulihan Terumbu Karang\",\"Nominal\":5000,\"Description\":\"Bersama BenihBaik.com, donasi akan disalurkan untuk pemulihan terumbu karang di daerah Papua Barat.\"},\"cod\":{\"is_cod\":false,\"counter_cod\":-1},\"message\":{\"message_info\":\"\",\"message_link\":\"\",\"message_logo\":\"\"},\"egold_attributes\":{\"eligible\":false,\"is_tiering\":false,\"is_opt_in\":false,\"range\":{\"min\":0,\"max\":0},\"message\":{\"title_text\":\"\",\"sub_text\":\"\",\"ticker_text\":\"\",\"tooltip_text\":\"\"},\"tier_data\":[]},\"tickers\":[{\"id\":700001,\"title\":\"\",\"message\":\"Yay, ongkir untuk pesanan dalam transaksi ini ditanggung Tokopedia!\",\"page\":\"checkout\"}],\"campaign_timer\":{\"description\":\"Selesaikan pembayaranmu dalam \",\"show_timer\":true,\"expired_timer_message\":{\"Button\":\"Belanja Lagi\",\"description\":\"Transaksi dibatalkan karena kamu tidak melakukan pembayaran hingga batas waktu berakhir.\",\"title\":\"Waktu pembayaran habis\"},\"timer_detail\":{\"deduct_time\":\"2022-09-27T17:00:28+07:00\",\"expire_duration\":180,\"expired_time\":\"2022-09-27T17:03:28+07:00\",\"server_time\":\"2022-09-27T17:00:29+07:00\"}},\"addresses\":{\"active\":\"\",\"disable_tabs\":[],\"data\":[]},\"disabled_features_detail\":{\"disabled_multi_address_message\":\"\"},\"promo\":{\"error_default\":{\"title\":\"promo tidak dapat digunakan\",\"description\":\"silahkan coba beberapa saat lagi\"},\"last_apply\":{\"code\":\"200000\",\"data\":{\"codes\":[],\"promo_code_id\":0,\"cashback_advocate_referral_amount\":0,\"cashback_wallet_amount\":0,\"discount_amount\":0,\"title_description\":\"Promo \",\"is_tokopedia_gerai\":false,\"global_success\":true,\"gateway_id\":\"53860745131894406905855\",\"is_coupon\":0,\"success\":true,\"invoice_description\":\"\",\"voucher_orders\":[{\"cashback_wallet_amount\":0,\"code\":\"BOINTERECISLANDQA50\",\"unique_id\":\"14000642-0-13883536-193890273\",\"discount_amount\":23600,\"address_id\":193890273,\"title_description\":\"Bebas Ongkir 50k Targeting\",\"is_po\":0,\"type\":\"logistic\",\"cart_id\":0,\"shop_id\":14000642,\"success\":true,\"invoice_description\":\"\",\"message\":{\"color\":\"#e0e0e0\",\"state\":\"grey\",\"text\":\"Kamu dapat potongan ongkir dari Tokopedia\"},\"benefit_details\":[{\"code\":\"BOINTERECISLANDQA50\",\"unique_id\":\"14000642-0-13883536-193890273\",\"cashback_amount\":0,\"discount_amount\":23600,\"type\":\"\",\"order_id\":1,\"benefit_product_details\":[{\"cashback_amount\":0,\"discount_amount\":23600,\"product_id\":4411133958,\"is_bebas_ongkir\":true}],\"promo_type\":{\"is_exclusive_shipping\":true,\"is_bebas_ongkir\":true}}]}],\"clashing_info_detail\":{\"is_clashed_promos\":false,\"clash_reason\":\"\",\"clash_message\":\"\"},\"tracking_details\":[{\"product_id\":4411133958,\"promo_codes_tracking\":\"BOINTERECISLANDQA50\",\"promo_details_tracking\":\"L:3:23600:grey\"}],\"message\":{\"color\":\"\",\"state\":\"\",\"text\":\"\"},\"additional_info\":{\"sp_ids\":[],\"usage_summaries\":[{\"description\":\"Bebas Ongkir\",\"type\":\"bebas_ongkir\",\"amount_str\":\"Rp23.600\",\"amount\":23600,\"currency_details_str\":\"\"}],\"message_info\":{\"message\":\"Kamu bisa hemat Rp23.600\",\"detail\":\"1 promo dipakai\"},\"error_detail\":{\"message\":\"\"},\"empty_cart_info\":{\"image_url\":\"\",\"detail\":\"\",\"message\":\"\"},\"promo_sp_ids\":[],\"poml_auto_applied\":false,\"bebas_ongkir_info\":{\"is_bo_unstack_enabled\":true}},\"benefit_summary_info\":{\"final_benefit_amount_str\":\"Rp23.600\",\"final_benefit_amount\":23600,\"final_benefit_text\":\"Total benefit anda: \",\"summaries\":[{\"amount\":23600,\"section_name\":\"Discount\",\"description\":\"Total diskon: \",\"section_description\":\"\",\"type\":\"discount\",\"amount_str\":\"Rp23.600\",\"details\":[{\"amount\":23600,\"section_name\":\"\",\"description\":\"Total Potongan Ongkos Kirim \",\"type\":\"shipping_discount\",\"amount_str\":\"Rp23.600\",\"points\":0,\"points_str\":\"\"}]}]},\"ticker_info\":{\"unique_id\":\"14000642-0-13883536-193890273\",\"status_code\":700001,\"message\":\"Success\"}}}},\"cross_sell\":[],\"add_on_wording\":{\"packaging_and_greeting_card\":\"\",\"only_greeting_card\":\"\",\"invoice_not_sent_to_recipient\":\"\"},\"upsell\":{\"is_show\":false,\"title\":\"\",\"description\":\"\",\"app_link\":\"\",\"image\":\"\"},\"cart_data\":\"{\\\"data\\\":{\\\"codes\\\":[],\\\"grand_total\\\":72000,\\\"book\\\":false,\\\"service_id\\\":731644293353960,\\\"secret_key\\\":\\\"9136a5d48e5883ffbe731e1b322cd5b7dfb4f6a6\\\",\\\"user_data\\\":{\\\"user_id\\\":176836759,\\\"email\\\":\\\"pbs-ilyas+buyer@tokopedia.com\\\",\\\"msisdn\\\":\\\"6285813484454\\\",\\\"msisdn_verified\\\":true,\\\"is_qc_acc\\\":true,\\\"app_version\\\":\\\"3.195\\\",\\\"ip_address\\\":\\\"182.253.224.180, 34.98.125.32\\\",\\\"user_agent\\\":\\\"TkpdConsumer/3.195 (Android 11;)\\\",\\\"advertisement_id\\\":\\\"8b87a7d3-40a2-42ee-8293-291b0bf0e439\\\",\\\"device_type\\\":\\\"android\\\",\\\"device_id\\\":\\\"feISS1p2Rq2gxG-CB6CNrJ:APA91bGFt9uL3wc7VPMVgD-ZszukP4HghDdGypGv1r7fScWX18Ybw0CTZLB3ZKQ-N5TalOXKI9DinqJali2b4-A6WtCqJ0XjwB3mx3DZ0f2ZV_5ULtQZXI3TI-D_jvNYbgOZhI1PXGLs\\\"},\\\"meta_data\\\":{\\\"orders\\\":[{\\\"shop_id\\\":14000642,\\\"shop_name\\\":\\\"s3ll3r-sh0p-01\\\",\\\"codes\\\":[\\\"BOINTERECISLANDQA50\\\"],\\\"unique_id\\\":\\\"14000642-0-13883536-193890273\\\",\\\"is_po\\\":false,\\\"duration\\\":\\\"0\\\",\\\"warehouse_id\\\":13883536,\\\"address_id\\\":193890273,\\\"fulfill_by\\\":0}]},\\\"state\\\":\\\"checkout\\\"}}\"}", ShipmentAddressFormDataResponse::class.java)
            return shipmentMapper.convertToShipmentAddressFormData(dummy)
        } else {
            if (response.shipmentAddressFormResponse.errorMessages.isNotEmpty()) {
                throw CartResponseErrorException(response.shipmentAddressFormResponse.errorMessages.joinToString())
            } else {
                throw CartResponseErrorException(CartConstant.CART_ERROR_GLOBAL)
            }
        }
    }

    companion object {
        private const val PARAM_KEY_LANG = "lang"
        private const val PARAM_KEY_IS_ONE_CLICK_SHIPMENT = "is_ocs"
        private const val PARAM_KEY_CORNER_ID = "corner_id"
        private const val PARAM_KEY_SKIP_ONBOARDING_UPDATE_STATE = "skip_onboarding"
        private const val PARAM_KEY_IS_TRADEIN = "is_trade_in"
        private const val PARAM_KEY_DEVICE_ID = "dev_id"
        private const val PARAM_KEY_VEHICLE_LEASING_ID = "vehicle_leasing_id"

        private const val QUERY_SHIPMENT_ADDRESS_FORM = "ShipmentAddressFormQuery"
    }

}
