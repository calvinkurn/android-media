package com.tokopedia.pdpsimulation.paylater.domain.usecase

import com.google.gson.Gson
import com.tokopedia.gql_query_annotation.GqlQuery
import com.tokopedia.graphql.coroutines.domain.interactor.GraphqlUseCase
import com.tokopedia.graphql.coroutines.domain.repository.GraphqlRepository
import com.tokopedia.pdpsimulation.common.constants.GQL_PAYLATER_SIMULATION_V2
import com.tokopedia.pdpsimulation.paylater.domain.model.PayLaterSimulationBaseResponse
import com.tokopedia.pdpsimulation.paylater.domain.model.PaylaterGetSimulationV2
import javax.inject.Inject

@GqlQuery("PayLaterAvailableOptionData", GQL_PAYLATER_SIMULATION_V2)
class PayLaterSimulationV2UseCase @Inject constructor(graphqlRepository: GraphqlRepository) :
    GraphqlUseCase<PayLaterSimulationBaseResponse>(graphqlRepository) {


    fun getPayLaterProductDetails(
        onSuccess: (PaylaterGetSimulationV2?) -> Unit,
        onError: (Throwable) -> Unit,
        amount: Long
    ) {
        try {
            this.setTypeClass(PayLaterSimulationBaseResponse::class.java)
            this.setRequestParams(getRequestParams(amount))
            this.setGraphqlQuery(PayLaterAvailableOptionData.GQL_QUERY)
            this.execute(
                { result ->
                    onSuccess(result.data.PaylaterGetSimulationV2)
                }, { error ->
                    onError(error)
                }
            )
        } catch (throwable: Throwable) {
            onError(throwable)
        }
    }

    fun mockData(): PaylaterGetSimulationV2? {
        return Gson().fromJson(
            mockResponse,
            PayLaterSimulationBaseResponse::class.java
        ).data.PaylaterGetSimulationV2
    }

    private fun getRequestParams(amount: Long): Map<String, Float> {
        return mapOf(PARAM_PRODUCT_AMOUNT to amount.toFloat())
    }

    companion object {
        const val PARAM_PRODUCT_AMOUNT = "Amount"
        const val mockResponse =
            "{\"data\":{\"paylater_getSimulationV2\":{\"data\":[{\"tenure\":1,\"text\":\"30 Hari Akhir Bulan\",\"detail\":[{\"gateway_id\":1,\"installment_per_month\":92746,\"installment_per_month_ceil\":92746,\"total_fee\":92746,\"total_fee_ceil\":93000,\"total_interest\":0,\"total_interest_ceil\":0,\"interest_pct\":0,\"total_with_provision\":92746,\"total_with_provision_ceil\":93000,\"is_recommended\":true,\"tenure\":1,\"activation_status\":3,\"account_status\":1,\"is_disabled\":false,\"cta\":{\"name\":\"Your Paylater is Now Active\",\"description_1\":\"Description of Activated Paylater\",\"description_2\":\"\",\"web_url\":\"http://tokopedia.com\",\"ios_url\":\"http://tokopedia.com\",\"android_url\":\"http://tokopedia.com\",\"cta_type\":1,\"is_redirect_url\":0,\"button_color\":\"\"},\"gateway_detail\":{\"gateway_id\":1,\"name\":\"Indodana\",\"product_code\":\"INDODANA\",\"is_active\":true,\"subheader\":\"\",\"img_light_url\":\"https://images.tokopedia.net/img/assets-fintech-frontend/pdp/indodanalogo.png\",\"img_dark_url\":\"https://images.tokopedia.net/img/assets-fintech-frontend/pdp/indodanalogo.png\",\"faq_url\":\"https://www.tokopedia.com/help/article/indodana\",\"apply_url\":\"https://tokopedia.link/cQK4WwnZjeb\",\"benefit\":[{\"content\":\"Nikmati bunga 0% jika bayar dalam 30 hari\",\"is_highlight\":true},{\"content\":\"Bebas belanja dengan limit s.d. Rp25 juta\",\"is_highlight\":true},{\"content\":\"Minimum transaksi hanya Rp10 ribu\",\"is_highlight\":true},{\"content\":\"Tersedia pembayaran 30 hari atau cicilan 3, 6, dan 12 bulan\",\"is_highlight\":false},{\"content\":\"Proses daftar hanya 5 menit, dapatkan persetujuan dalam 1x24 jam\",\"is_highlight\":false},{\"content\":\"Bunga 3% untuk cicilan\",\"is_highlight\":false},{\"content\":\"Biaya layanan 1% untuk setiap transaksi\",\"is_highlight\":false},{\"content\":\"Syarat daftar: KTP, selfie, dan pendapatan min. Rp3,5 juta per bulan\",\"is_highlight\":false}],\"detail\":[{\"title\":\"Limit pinjaman\",\"content\":[\"Hingga Rp25 juta\"]},{\"title\":\"Lama pengembalian\",\"content\":[\"Sekali bayar 30 hari\",\"Cicilan 3, 6, dan 12 bulan\"]},{\"title\":\"Bunga per bulan\",\"content\":[\"0% untuk sekali bayar\",\"3% untuk cicilan 3, 6, dan 12 bulan\"]},{\"title\":\"Biaya lainnya\",\"content\":[\"Biaya layanan 1% untuk tiap transaksi di semua tenor\"]}],\"faq\":[{\"question\":\"Bagaimana cara mendaftar di Kredivo?\",\"answer\":\"Isi form dengan lengkap selama 5 menit.\"},{\"question\":\"Berapa lama proses pendaftaran di Indodana?\",\"answer\":\"Maksimal 1x24 jam.\"}],\"how_to_use\":{\"notes\":[\"Pastikan kamu telah terdaftar di aplikasi Indodana dan telah mendapatkan limit untuk belanja.\"],\"steps\":[\"Pilih barang yang ingin dibeli, bebas pilih bayar dalam 30 hari atau cicilan (min. transaksi Rp 500 ribu).\",\"Di halaman Pembayaran, pilih <b>Paylater & Cicilan</b> dan pilih <b>Indodana</b>\",\"Pilih durasi cicilan, dan klik Lanjut.\",\"Di halaman Indodana, masukkan nomor HP dan PIN yang terdaftar di akun Indodana-mu. Lalu, klik Bayar.\",\"Barangmu akan otomatis terbayar!\"]},\"how_to_apply\":{\"notes\":[],\"steps\":[]},\"tnc\":[\"WNI dan memiliki KTP\",\"Penghasilan per bulan min Rp3,5 juta\"]}},{\"gateway_id\":6,\"installment_per_month\":100000,\"installment_per_month_ceil\":100000,\"total_fee\":100000,\"total_fee_ceil\":100000,\"total_interest\":0,\"total_interest_ceil\":0,\"interest_pct\":0,\"total_with_provision\":100000,\"total_with_provision_ceil\":100000,\"is_recommended\":false,\"tenure\":1,\"activation_status\":3,\"account_status\":1,\"is_disabled\":false,\"cta\":{\"name\":\"Your Paylater is Now Active\",\"description_1\":\"Description of Activated Paylater\",\"description_2\":\"\",\"web_url\":\"http://tokopedia.com\",\"ios_url\":\"http://tokopedia.com\",\"android_url\":\"http://tokopedia.com\",\"cta_type\":1,\"is_redirect_url\":0,\"button_color\":\"\"},\"gateway_detail\":{\"gateway_id\":6,\"name\":\"GoPaylater\",\"product_code\":\"GOPAYLATER\",\"is_active\":true,\"subheader\":\"\",\"img_light_url\":\"https://images.tokopedia.net/img/assets-fintech-frontend/pdp/briceria/Logo-Ceria.png\",\"img_dark_url\":\"https://images.tokopedia.net/img/assets-fintech-frontend/pdp/briceria/Logo-Ceria.png\",\"faq_url\":\"https://www.tokopedia.com/help/article/briceria\",\"apply_url\":\"https://tokopedia.link/0aKn3spZjeb\",\"benefit\":[{\"content\":\"Bebas belanja dengan limit dari Rp500 ribu sampai Rp20 juta\",\"is_highlight\":true},{\"content\":\"Dapatkan persetujuan sekitar 10 menit setelah daftar\",\"is_highlight\":true},{\"content\":\"Tanpa minimum transaksi\",\"is_highlight\":true},{\"content\":\"Tersedia pembayaran 30 hari atau cicilan 3, 6, 9, dan 12 bulan\",\"is_highlight\":false},{\"content\":\"Bunga 1,2% untuk pembayaran 30 hari dan 1,42% untuk cicilan\",\"is_highlight\":false},{\"content\":\"Biaya layanan 1,5% untuk setiap transaksi\",\"is_highlight\":false},{\"content\":\"Syarat daftar: KTP, rekening BRI, dan ATM BRI\",\"is_highlight\":false}],\"detail\":[{\"title\":\"Limit pinjaman\",\"content\":[\"Rp500 ribu - Rp25 juta\"]},{\"title\":\"Lama pengembalian\",\"content\":[\"Sekali bayar 30 hari\",\"Cicilan 3, 6, 9, dan 12 bulan\"]},{\"title\":\"Bunga per bulan\",\"content\":[\"1,2% untuk sekali bayar\",\"1.42% untuk cicilan\"]},{\"title\":\"Biaya lainnya\",\"content\":[\"Biaya layanan 1.5% untuk setiap transaksi\"]}],\"faq\":[{\"question\":\"Bagaimana cara mendaftar di Kredivo?\",\"answer\":\"Isi form dengan lengkap selama 5 menit.\"},{\"question\":\"Berapa lama proses pendaftaran di BRI Ceria?\",\"answer\":\"Maksimal 1x24 jam.\"}],\"how_to_use\":{\"notes\":[\"Pembayaran dengan BRI Ceria khusus untuk nasabah BRI & memiliki akun di aplikasi Ceria\"],\"steps\":[\"Download aplikasi Ceria dan daftar dengan nomor HP-mu.\",\"Masukkan kode verifikasi dan buat PIN. Setelah berhasil, kamu bisa tekan <b>Ajukan Limit Sekarang</b>.\",\"Masukkan nomor kartu ATM BRI kamu yang aktif.\",\"Upload foto KTP dan isi formulir pengajuan, lalu klik <b>Kirim</b>.\",\"Kamu akan menerima e-mail pengajuan, klik Verifikasi pada email tersebut. Setelah berhasil, kamu akan <b>mendapat limit</b>.\",\"Limit sudah bisa digunakan di Tokopedia! Pilih barang yang ingin dibeli dan pilih BRI Ceria di halaman pembayaran.\",\"Pilih lama cicilan dan klik Lanjutkan. Kamu akan diminta memasukkan kode verifikasi. Transaksimu akan terbayar!\"]},\"how_to_apply\":{\"notes\":[\"Waktu proses pengajuan sedang mengalami keterlambatan, mohon menunggu 2 x 24 jam.\"],\"steps\":[\"Klik tombol Daftar Sekarang, kamu akan diarahkan menuju formulir pengajuan Kredivo.\",\"Upload foto KTP dan selfie, lalu lengkapi formulir pengajuan. Jika sudah, kirim pengajuan.\",\"Pengajuanmu akan diverifikasi selama maks. 24 jam. Setelah disetujui, Kamu bisa langsung gunakan untuk belanja!\"]},\"tnc\":[\"WNI dan memiliki KTP\",\"Memiliki rekening dan ATM Bank BRI\"]}},{\"gateway_id\":4,\"installment_per_month\":0,\"installment_per_month_ceil\":0,\"total_fee\":0,\"total_fee_ceil\":0,\"total_interest\":0,\"total_interest_ceil\":0,\"interest_pct\":0,\"total_with_provision\":0,\"total_with_provision_ceil\":0,\"is_recommended\":false,\"tenure\":1,\"activation_status\":3,\"account_status\":1,\"is_disabled\":true,\"cta\":{\"name\":\"\",\"description_1\":\"\",\"description_2\":\"\",\"web_url\":\"\",\"ios_url\":\"\",\"android_url\":\"\",\"cta_type\":0,\"is_redirect_url\":0,\"button_color\":\"\"},\"gateway_detail\":{\"gateway_id\":4,\"name\":\"BRI Ceria\",\"product_code\":\"BRICERIA\",\"is_active\":true,\"subheader\":\"\",\"img_light_url\":\"https://images.tokopedia.net/img/assets-fintech-frontend/pdp/briceria/Logo-Ceria.png\",\"img_dark_url\":\"https://images.tokopedia.net/img/assets-fintech-frontend/pdp/briceria/Logo-Ceria.png\",\"faq_url\":\"https://www.tokopedia.com/help/article/briceria\",\"apply_url\":\"https://tokopedia.link/0aKn3spZjeb\",\"benefit\":[{\"content\":\"Bebas belanja dengan limit dari Rp500 ribu sampai Rp20 juta\",\"is_highlight\":true},{\"content\":\"Dapatkan persetujuan sekitar 10 menit setelah daftar\",\"is_highlight\":true},{\"content\":\"Tanpa minimum transaksi\",\"is_highlight\":true},{\"content\":\"Tersedia pembayaran 30 hari atau cicilan 3, 6, 9, dan 12 bulan\",\"is_highlight\":false},{\"content\":\"Bunga 1,2% untuk pembayaran 30 hari dan 1,42% untuk cicilan\",\"is_highlight\":false},{\"content\":\"Biaya layanan 1,5% untuk setiap transaksi\",\"is_highlight\":false},{\"content\":\"Syarat daftar: KTP, rekening BRI, dan ATM BRI\",\"is_highlight\":false}],\"detail\":[{\"title\":\"Limit pinjaman\",\"content\":[\"Rp500 ribu - Rp25 juta\"]},{\"title\":\"Lama pengembalian\",\"content\":[\"Sekali bayar 30 hari\",\"Cicilan 3, 6, 9, dan 12 bulan\"]},{\"title\":\"Bunga per bulan\",\"content\":[\"1,2% untuk sekali bayar\",\"1.42% untuk cicilan\"]},{\"title\":\"Biaya lainnya\",\"content\":[\"Biaya layanan 1.5% untuk setiap transaksi\"]}],\"faq\":[{\"question\":\"Bagaimana cara mendaftar di Kredivo?\",\"answer\":\"Isi form dengan lengkap selama 5 menit.\"},{\"question\":\"Berapa lama proses pendaftaran di BRI Ceria?\",\"answer\":\"Maksimal 1x24 jam.\"}],\"how_to_use\":{\"notes\":[\"Pembayaran dengan BRI Ceria khusus untuk nasabah BRI & memiliki akun di aplikasi Ceria\"],\"steps\":[\"Download aplikasi Ceria dan daftar dengan nomor HP-mu.\",\"Masukkan kode verifikasi dan buat PIN. Setelah berhasil, kamu bisa tekan <b>Ajukan Limit Sekarang</b>.\",\"Masukkan nomor kartu ATM BRI kamu yang aktif.\",\"Upload foto KTP dan isi formulir pengajuan, lalu klik <b>Kirim</b>.\",\"Kamu akan menerima e-mail pengajuan, klik Verifikasi pada email tersebut. Setelah berhasil, kamu akan <b>mendapat limit</b>.\",\"Limit sudah bisa digunakan di Tokopedia! Pilih barang yang ingin dibeli dan pilih BRI Ceria di halaman pembayaran.\",\"Pilih lama cicilan dan klik Lanjutkan. Kamu akan diminta memasukkan kode verifikasi. Transaksimu akan terbayar!\"]},\"how_to_apply\":{\"notes\":[],\"steps\":[]},\"tnc\":[\"WNI dan memiliki KTP\",\"Memiliki rekening dan ATM Bank BRI\"]}},{\"gateway_id\":2,\"installment_per_month\":94574,\"installment_per_month_ceil\":94574,\"total_fee\":94574,\"total_fee_ceil\":95000,\"total_interest\":0,\"total_interest_ceil\":0,\"interest_pct\":0,\"total_with_provision\":94574,\"total_with_provision_ceil\":95000,\"is_recommended\":false,\"tenure\":1,\"activation_status\":7,\"account_status\":1,\"is_disabled\":true,\"cta\":{\"name\":\"\",\"description_1\":\"\",\"description_2\":\"\",\"web_url\":\"\",\"ios_url\":\"\",\"android_url\":\"\",\"cta_type\":0,\"is_redirect_url\":0,\"button_color\":\"\"},\"gateway_detail\":{\"gateway_id\":2,\"name\":\"Kredivo\",\"product_code\":\"KREDIVO\",\"is_active\":true,\"subheader\":\"Yuk, daftar sekarang!\",\"img_light_url\":\"https://ecs7.tokopedia.net/assets-fintech-frontend/pdp/kredivo/kredivo.png\",\"img_dark_url\":\"https://ecs7.tokopedia.net/assets-fintech-frontend/pdp/kredivo/kredivo.png\",\"faq_url\":\"https://www.tokopedia.com/help/article/kredivo\",\"apply_url\":\"https://www.tokopedia.com/kredivo\",\"benefit\":[{\"content\":\"Nikmati bunga 0% jika bayar dalam 30 hari\",\"is_highlight\":true},{\"content\":\"Tidak perlu down payment/uang muka\",\"is_highlight\":true},{\"content\":\"Bebas belanja dengan limit s.d. Rp30 juta\",\"is_highlight\":true},{\"content\":\"Tersedia pembayaran 30 hari atau cicilan 3, 6, dan 12 bulan\",\"is_highlight\":false},{\"content\":\"Proses daftar hanya 5 menit, dapatkan persetujuan dalam 1x24 jam\",\"is_highlight\":false},{\"content\":\"Biaya layanan 2% dan biaya tambahan 1% untuk pembayaran 30 hari\",\"is_highlight\":false},{\"content\":\"Bunga 2,6% dan biaya layanan 1,5% untuk cicilan\",\"is_highlight\":false},{\"content\":\"Syarat daftar: KTP, selfie, dan pendapatan min. Rp3 juta per bulan\",\"is_highlight\":false}],\"detail\":[{\"title\":\"Limit pinjaman\",\"content\":[\"Hingga Rp30 juta\"]},{\"title\":\"Lama pengembalian\",\"content\":[\"Sekali bayar 30 hari\",\"Cicilan 3, 6 dan 12 bulan\"]},{\"title\":\"Bunga per bulan\",\"content\":[\"0% untuk sekali bayar\",\"2,6% untuk cicilan 3, 6, dan 12 bulan\"]},{\"title\":\"Biaya lainnya\",\"content\":[\"Biaya layanan 2% dan tambahan 1% untuk 30 hari\",\"Biaya layanan 1,5% untuk cicilan\"]}],\"faq\":[{\"question\":\"Bagaimana cara mendaftar di Kredivo?\",\"answer\":\"Isi form dengan lengkap selama 5 menit.\"},{\"question\":\"Berapa lama proses pendaftaran di Kredivo?\",\"answer\":\"Maksimal 1x24 jam.\"}],\"how_to_use\":{\"notes\":[],\"steps\":[\"Pilih barang yang ingin dibeli, dan pilih metode pembayaran <b>Kredivo</b> di halaman Pembayaran.\",\"Bebas pilih bayar dalam 30 hari atau cicilan (min. transaksi Rp1 juta). Klik Lanjut.\",\"Di halaman Kredivo, kamu bisa klik menu <b>Voucher Untukmu</b> untuk menggunakan promo.\",\"Masukkan kode verifikasi lalu klik <b>Bayar</b>.\"]},\"how_to_apply\":{\"notes\":[\"Waktu proses pengajuan sedang mengalami keterlambatan, mohon menunggu 2 x 24 jam.\"],\"steps\":[\"Klik tombol Daftar Sekarang, kamu akan diarahkan menuju formulir pengajuan Kredivo.\",\"Upload foto KTP dan selfie, lalu lengkapi formulir pengajuan. Jika sudah, kirim pengajuan.\",\"Pengajuanmu akan diverifikasi selama maks. 24 jam. Setelah disetujui, Kamu bisa langsung gunakan untuk belanja!\"]},\"tnc\":[\"WNI dan memiliki KTP\",\"Penghasilan per bulan min. Rp3 juta\"]}}]}]}}}"
    }
}