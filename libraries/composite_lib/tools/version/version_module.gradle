import com.tokopedia.plugin.ScanReleaseDateTask
import com.tokopedia.plugin.ReadVersionConfigTask
import com.tokopedia.plugin.ScanProjectTask
import com.tokopedia.plugin.PublishCompositeTask

task scanReleaseDate(type: ScanReleaseDateTask){
    doFirst {
        println("[SCAN RELEASE DATE TASK START]")
    }
    doLast{
        println("[SCAN RELEASE DATE TASK FINISHED]")
    }
}

task readVersionConfigTask(type: ReadVersionConfigTask) {
    doFirst {
        println("[READ VERSION CONFIG TASK START]")
    }
    doLast {
        println("[READ VERSION CONFIG TASK END]")
    }
}

task scanProjectTask(type: ScanProjectTask) {
    dependsOn 'scanReleaseDate'
    dependsOn 'readVersionConfigTask'
    doFirst {
        println("[VERSION TASK START]")
        versionConfigMap = readVersionConfigTask.versionConfigMap
        latestReleaseDate = scanReleaseDate.latestReleaseDate
    }
    doLast {
        println("[VERSION TASK END]")
    }
}

task versionDependency(type: PublishCompositeTask, dependsOn: scanProjectTask){
    doFirst {
        println("[PUBLISH COMPOSITE TASK START]")
        latestReleaseDate = scanProjectTask.latestReleaseDate
        dependenciesProjectNameHashSet = scanProjectTask.dependenciesProjectNameHashSet
        candidateModuleListToUpdate = scanProjectTask.candidateModuleListToUpdate
        projectToArtifactInfoList = scanProjectTask.projectToArtifactInfoList
        artifactIdToProjectNameList = scanProjectTask.artifactIdToProjectNameList
        versionConfigMap = scanProjectTask.versionConfigMap
    }
    doLast{
        println("[PUBLISH COMPOSITE TASK FINISHED]")
    }
}