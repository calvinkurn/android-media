import com.tokopedia.plugin.ScanProjectTask
import com.tokopedia.plugin.ScanReleaseDateTask

// jadi cara `ini` store semua variable diantara task
task readGradlefile(type: ReadGradlefileTasks){
    subprojects = project.subprojects
    doLast{
        lastRelease = scanReleaseDate.listReleaseDate[scanReleaseDate.listReleaseDate.size()-1]
        listVersion = versionDependency.listVersion
        listTree = versionDependency.listTree
        topList()
        readVersionConfig()
        moduleVersionUpdate()
    }
}

// scan semua subproject dan simpan dalam list `listModule`
task scanProject(type: ScanProjectTask){}

task scanReleaseDate(type: ScanReleaseDateTask){
    dependsOn(scanProject)
    print("End Scan Release Date")
}

task versionDependency(type: VersionTasks, dependsOn: scanReleaseDate) {
    // simpan list release date
    listReleaseDate = scanReleaseDate.listReleaseDate

    // setelah task dipanggil selesaikan dengan readGradle
    finalizedBy readGradlefile

    // simpan root Project {Project}
    rootProjectTask = rootProject
}

configurations {
    myDownloads
}
dependencies {
    myDownloads 'com.tokopedia.config:global_config:1.0.3'
}

task getDeps(type: Copy) {
    from configurations.myDownloads
    into 'tools/version/latestaar'
}