apply plugin: 'com.android.library'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'
apply plugin: 'io.hansel.preprocessor.module'

buildscript {
    repositories {
        google()
        maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
        mavenCentral()
        maven { url 'https://maven-hansel.tokopedia.com/maven' }
    }
    dependencies {
        classpath rootProject.ext.miscDependencies.hansel
    }
}

android {
    namespace 'com.tokopedia.customer_mid_app'
    testNamespace 'com.tokopedia.customer_mid_app.test'
    compileSdkVersion rootProject.ext.compileSdkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion

    defaultConfig {
        multiDexEnabled true
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion

        vectorDrawables.useSupportLibrary = vectorDrawable.toBoolean()
        testInstrumentationRunner "com.tokopedia.test.application.environment.InstrumentationTestRunner"
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }
    packagingOptions {
        exclude 'META-INF/**'
    }
    lintOptions {
        abortOnError false
        xmlReport true
        htmlReport false
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    implementation projectOrAar(rootProject.ext.features.notifTroubleshooter)
    implementation projectOrAar(rootProject.ext.features.affiliateCommon)
    implementation projectOrAar(rootProject.ext.features.contentCommon)
    implementation projectOrAar(rootProject.ext.features.feedComponent)
    implementation projectOrAar(rootProject.ext.features.kolCommon)
    implementation projectOrAar(rootProject.ext.features.home)
    implementation projectOrAar(rootProject.ext.features.commonWallet)
    implementation projectOrAar(rootProject.ext.features.recommendationWidgetCommon)
    implementation projectOrAar(rootProject.ext.features.topAdsSdk)
    implementation projectOrAar(rootProject.ext.features.reputationCommon)
    implementation projectOrAar(rootProject.ext.features.commonTopupBills)
    implementation projectOrAar(rootProject.ext.features.logout)
    implementation projectOrAar(rootProject.ext.features.topAdsManagementCommon)
    implementation projectOrAar(rootProject.ext.features.productManageCommon)
    implementation projectOrAar(rootProject.ext.features.atc_common)
    implementation projectOrAar(rootProject.ext.features.discovery2)
    implementation projectOrAar(rootProject.ext.features.logisticCommon)
    implementation projectOrAar(rootProject.ext.features.localizationchooseaddress)
    implementation projectOrAar(rootProject.ext.features.localizationchooseaddress_common)
    implementation projectOrAar(rootProject.ext.features.nps)
    implementation projectOrAar(rootProject.ext.features.withdraw)
    implementation projectOrAar(rootProject.ext.features.wishlistCommonV2)
    implementation projectOrAar(rootProject.ext.features.productCard)
    implementation projectOrAar(rootProject.ext.features.searchbar)
    implementation projectOrAar(rootProject.ext.features.navigationCommon)
    implementation projectOrAar(rootProject.ext.features.chooseaccount)
    implementation projectOrAar(rootProject.ext.features.sessioncommon)
    implementation projectOrAar(rootProject.ext.features.promoCheckout)
    implementation projectOrAar(rootProject.ext.features.promoCheckoutCommon)
    implementation projectOrAar(rootProject.ext.features.playCommon)
    implementation projectOrAar(rootProject.ext.features.productShare)
    implementation projectOrAar(rootProject.ext.libraries.irisSession)
    implementation projectOrAar(rootProject.ext.libraries.baseList)
    implementation projectOrAar(rootProject.ext.libraries.dynamicFeatures)
    implementation projectOrAar(rootProject.ext.libraries.imageuploader)
    implementation projectOrAar(rootProject.ext.libraries.datePickerRange)
    implementation projectOrAar(rootProject.ext.libraries.baseListSeller)
    implementation projectOrAar(rootProject.ext.libraries.locationmanager)
    implementation projectOrAar(rootProject.ext.libraries.imagePreviewSlider)
    implementation projectOrAar(rootProject.ext.libraries.imagePreview)
    implementation projectOrAar(rootProject.ext.features.attachcommon)
    implementation projectOrAar(rootProject.ext.features.common_promo)
    implementation projectOrAar(rootProject.ext.libraries.bannerDynamic)
    implementation projectOrAar(rootProject.ext.libraries.inappupdate)
    implementation projectOrAar(rootProject.ext.libraries.youtubeutil)
    implementation projectOrAar(rootProject.ext.features.tokopointsNotification)
    implementation projectOrAar(rootProject.ext.libraries.collapsingTabLayout)
    implementation projectOrAar(rootProject.ext.libraries.websocket)
    implementation projectOrAar(rootProject.ext.libraries.baseAdapter)
    implementation projectOrAar(rootProject.ext.features.csat_rating)
    implementation projectOrAar(rootProject.ext.features.resourcesCommon)
    implementation projectOrAar(rootProject.ext.features.agerestriction)
    implementation projectOrAar(rootProject.ext.features.appCommon)
    implementation projectOrAar(rootProject.ext.features.autocompleteComponent)
    implementation projectOrAar(rootProject.ext.features.tokochat_common)
    implementation projectOrAar(rootProject.ext.features.tokochat_config_common)
    implementation rootProject.ext.tkpdInternalLibDependencies.akamaiBMP
    if (rootProject.ext.debugToolsEnabled) {
        implementation rootProject.ext.tkpdInternalLibDependencies.fakeresponse
    } else {
        implementation rootProject.ext.tkpdInternalLibDependencies.fakeresponseNoOp
    }
    implementation rootProject.ext.tkpdInternalLibDependencies.analyticAnnotation
    implementation rootProject.ext.tkpdInternalLibDependencies.analyticFirebaseRules
    implementation rootProject.ext.tkpdInternalLibDependencies.analyticParam
    implementation rootProject.ext.composeDependencies.composeActivity
    implementation rootProject.ext.composeDependencies.composeConstraint
    implementation rootProject.ext.unifyDependencies.components
    implementation rootProject.ext.unifyDependencies.nestComponents
    implementation rootProject.ext.unifyDependencies.icons
    implementation rootProject.ext.unifyDependencies.global_error
    implementation rootProject.ext.unifyDependencies.coach_mark
    implementation rootProject.ext.unifyDependencies.banner
    implementation rootProject.ext.unifyDependencies.datepicker
    implementation rootProject.ext.unifyDependencies.header
    implementation rootProject.ext.unifyDependencies.iconNotification
    implementation rootProject.ext.unifyDependencies.sortFilter
    implementation rootProject.ext.unifyDependencies.pin
    implementation rootProject.ext.unifyDependencies.accordion
    implementation rootProject.ext.playServicesDependencies.maps
    implementation rootProject.ext.supportLibDependencies.supportV13
    implementation rootProject.ext.miscDependencies.lottie
    implementation rootProject.ext.miscDependencies.biometric
    implementation platform(rootProject.ext.firebase.bom)
    implementation rootProject.ext.firebase.core
    implementation rootProject.ext.firebase.analytics
    implementation rootProject.ext.firebase.fireStore
    implementation rootProject.ext.networkDependencies.converterGson
    implementation rootProject.ext.networkDependencies.adapterRxJava
    implementation rootProject.ext.miscDependencies.roundCornerProgressBar
    implementation rootProject.ext.miscDependencies.apacheLang
    implementation(rootProject.ext.miscDependencies.flexBoxLayout) {
        exclude group: 'com.android.support'
    }
    implementation rootProject.ext.supportLibDependencies.exifinterface
    implementation rootProject.ext.miscDependencies.exoPlayerCore
    implementation rootProject.ext.miscDependencies.exoPlayerUi
    implementation rootProject.ext.miscDependencies.exoPlayerRtmp
    implementation rootProject.ext.miscDependencies.lifeCycleExtentions
    implementation rootProject.ext.miscDependencies.liveDataKtx
    annotationProcessor rootProject.ext.dbDependencies.dbRoomCompiler
    implementation rootProject.ext.miscDependencies.multiDex
    implementation rootProject.ext.tkpdInternalLibDependencies.analyticGTMUtil
    implementation 'com.facebook.infer.annotation:infer-annotation:0.11.2'
    implementation rootProject.ext.testDependencies.espressoIdlingResource

    //Dependency used for DF module
    implementation projectOrAar(rootProject.ext.features.commonTravel)
    implementation projectOrAar(rootProject.ext.features.commonEntertainment)
    implementation projectOrAar(rootProject.ext.features.payment)
    implementation projectOrAar(rootProject.ext.features.pdpPaylaterWidget)
    implementation projectOrAar(rootProject.ext.features.explore)
    implementation projectOrAar(rootProject.ext.features.commonElectronicMoney)
    implementation projectOrAar(rootProject.ext.features.sellerActiveCommon)
    implementation projectOrAar(rootProject.ext.features.productDetailCommon)
    implementation projectOrAar(rootProject.ext.features.commonPayment)
    implementation projectOrAar(rootProject.ext.features.otp)
    implementation projectOrAar(rootProject.ext.features.goldMerchantCommon)
    implementation projectOrAar(rootProject.ext.features.homecredit)
    implementation projectOrAar(rootProject.ext.features.fcm_common)
    implementation projectOrAar(rootProject.ext.features.logisticcart)
    implementation projectOrAar(rootProject.ext.features.chatcommon)
    implementation projectOrAar(rootProject.ext.features.qrscanner)
    implementation projectOrAar(rootProject.ext.features.navigation)
    implementation projectOrAar(rootProject.ext.libraries.deviceFingerprint)
    implementation projectOrAar(rootProject.ext.libraries.logger)
    implementation projectOrAar(rootProject.ext.libraries.interceptors)
    implementation projectOrAar(rootProject.ext.features.productServiceWidget)
    implementation projectOrAar(rootProject.ext.features.attachproduct)
    implementation projectOrAar(rootProject.ext.features.basemvvm)
    implementation projectOrAar(rootProject.ext.features.loginregister)
    implementation projectOrAar(rootProject.ext.features.accountlinking)
    implementation projectOrAar(rootProject.ext.features.homeAccountUser)
    implementation projectOrAar(rootProject.ext.features.logout)
    implementation projectOrAar(rootProject.ext.features.chooseaccount)
    implementation projectOrAar(rootProject.ext.features.sessioncommon)
    implementation projectOrAar(rootProject.ext.features.commonDigital)
    implementation projectOrAar(rootProject.ext.features.digitalRecommendation)
    implementation projectOrAar(rootProject.ext.libraries.iris)
    implementation projectOrAar(rootProject.ext.libraries.pushNotification)
    implementation projectOrAar(rootProject.ext.libraries.applink)
    implementation projectOrAar(rootProject.ext.libraries.tkpdabstraction)
    implementation projectOrAar(rootProject.ext.libraries.tkpddesign)
    implementation projectOrAar(rootProject.ext.features.mediauploader)
    implementation projectOrAar(rootProject.ext.features.medialoader)
    implementation projectOrAar(rootProject.ext.features.mediapickerCommon)
    implementation projectOrAar(rootProject.ext.features.commonEPharmacy)
    implementation projectOrAar(rootProject.ext.libraries.oms)
    implementation projectOrAar(rootProject.ext.libraries.fingerprint)
    implementation projectOrAar(rootProject.ext.libraries.imagePickerCommon)
    implementation projectOrAar(rootProject.ext.libraries.travelCalendar)
    implementation projectOrAar(rootProject.ext.libraries.commonNetwork)
    implementation projectOrAar(rootProject.ext.libraries.remoteConfig)
    implementation projectOrAar(rootProject.ext.libraries.core_legacy)
    implementation projectOrAar(rootProject.ext.libraries.coreNetwork)
    implementation projectOrAar(rootProject.ext.libraries.trackingOptimizer)
    implementation projectOrAar(rootProject.ext.libraries.utils)
    implementation projectOrAar(rootProject.ext.libraries.devMonitoringTools)
    implementation projectOrAar(rootProject.ext.features.reviewCommon)
    implementation projectOrAar(rootProject.ext.features.reviewInbox)
    implementation projectOrAar(rootProject.ext.features.inboxCommon)
    implementation projectOrAar(rootProject.ext.features.shopCommon)
    implementation projectOrAar(rootProject.ext.features.shopAdminCommon)
    implementation projectOrAar(rootProject.ext.features.orderManagementCommon)
    implementation projectOrAar(rootProject.ext.features.youtubeCommon)
    implementation projectOrAar(rootProject.ext.features.merchantVoucher)
    implementation projectOrAar(rootProject.ext.features.navigationCommon)
    implementation projectOrAar(rootProject.ext.libraries.analytics)
    implementation projectOrAar(rootProject.ext.libraries.linker)
    implementation projectOrAar(rootProject.ext.libraries.weaver)
    implementation projectOrAar(rootProject.ext.libraries.cmPushNotifications)
    implementation projectOrAar(rootProject.ext.libraries.track)
    implementation projectOrAar(rootProject.ext.libraries.webview)
    implementation projectOrAar(rootProject.ext.libraries.logger)
    implementation projectOrAar(rootProject.ext.features.filter)
    implementation projectOrAar(rootProject.ext.features.commonTradein)
    implementation projectOrAar(rootProject.ext.features.promotionsTarget)
    implementation projectOrAar(rootProject.ext.features.promoGamificationCommon)
    implementation projectOrAar(rootProject.ext.libraries.shakeDetect)
    implementation projectOrAar(rootProject.ext.libraries.mapviewer)
    implementation projectOrAar(rootProject.ext.libraries.deviceInfo)
    implementation projectOrAar(rootProject.ext.features.install_referral)
    implementation projectOrAar(rootProject.ext.features.additional_check)
    implementation projectOrAar(rootProject.ext.libraries.graphql)
    implementation projectOrAar(rootProject.ext.libraries.akamaiBotLib)
    implementation projectOrAar(rootProject.ext.libraries.remoteResourceRequest)
    implementation projectOrAar(rootProject.ext.libraries.telemetry)
    implementation projectOrAar(rootProject.ext.libraries.keys)
    implementation projectOrAar(rootProject.ext.libraries.encryption)
    implementation projectOrAar(rootProject.ext.features.agerestriction)
    implementation projectOrAar(rootProject.ext.features.scpRewardsCommon)
    implementation projectOrAar(rootProject.ext.features.scpRewardsWidgets)
    if (rootProject.ext.debugToolsEnabled) {
        implementation projectOrAar(rootProject.ext.features.developerOptions)
    } else {
        implementation projectOrAar(rootProject.ext.features.developerOptionsNoop)
    }
    if (rootProject.ext.debugToolsEnabled) {
        implementation projectOrAar(rootProject.ext.libraries.analyticsDebugger)
        implementation rootProject.ext.tkpdInternalLibDependencies.cassava
    } else {
        implementation projectOrAar(rootProject.ext.libraries.analyticsDebuggerNoop)
        implementation rootProject.ext.tkpdInternalLibDependencies.cassavaNoOp
    }

    implementation projectOrAar(rootProject.ext.libraries.pageInfoPusher)

    if (rootProject.ext.debugToolsEnabled) {
        implementation projectOrAar(rootProject.ext.libraries.preReleaseInspector)
    } else {
        implementation projectOrAar(rootProject.ext.libraries.preReleaseInspectorNoop)
    }

    if (rootProject.ext.debugToolsEnabled) {
        implementation projectOrAar(rootProject.ext.libraries.journeyDebugger)
    } else {
        implementation projectOrAar(rootProject.ext.libraries.journeyDebuggerNoop)
    }

    // in~house dependencies
    implementation projectOrAar(rootProject.ext.libraries.usersession)
    implementation rootProject.ext.tkpdInternalLibDependencies.cachemanager
    implementation projectOrAar(rootProject.ext.libraries.usersession)
    implementation rootProject.ext.tkpdInternalLibDependencies.usecase
    implementation projectOrAar(rootProject.ext.libraries.network)
    implementation rootProject.ext.tkpdInternalLibDependencies.globalconfig
    implementation rootProject.ext.tkpdInternalLibDependencies.url
    implementation rootProject.ext.playServicesDependencies.measurementApi
    implementation projectOrAar(rootProject.ext.libraries.youtubePlayer)

    // lint checks
    lintChecks rootProject.ext.tkpdInternalLibDependencies.lint

    // Embrace
    implementation rootProject.ext.miscDependencies.embraceSdk

    //new relic sdk
    implementation rootProject.ext.miscDependencies.newRelic

    // unify dependencies
    implementation rootProject.ext.unifyDependencies.principles
    implementation rootProject.ext.unifyDependencies.nestPrinciples

    // external dependencies
    implementation(rootProject.ext.debugToolsDependencies.timber) {
        exclude group: 'org.jetbrains', module: 'annotations'
    }
    implementation rootProject.ext.networkDependencies.retrofit
    implementation rootProject.ext.playServicesDependencies.core
    implementation rootProject.ext.playServicesDependencies.auth
    implementation rootProject.ext.supportLibDependencies.kotlinSupport
    implementation rootProject.ext.supportLibDependencies.kotlinSupportJdk7
    implementation rootProject.ext.tkpdLibDependencies.youtubePlayer
    implementation rootProject.ext.firebase.config
    implementation rootProject.ext.firebase.messaging
    implementation rootProject.ext.playServicesDependencies.analytics
    implementation (rootProject.ext.firebase.crashlytics) {
        transitive = true
    }
    implementation rootProject.ext.playServicesDependencies.location
    implementation rootProject.ext.debugToolsDependencies.chuck
    implementation rootProject.ext.supportLibDependencies.design
    implementation rootProject.ext.supportLibDependencies.cardViewV7
    implementation rootProject.ext.networkDependencies.retrofit
    implementation rootProject.ext.networkDependencies.okHttp
    implementation rootProject.ext.networkDependencies.loggingInterceptor
    implementation rootProject.ext.networkDependencies.glide
    implementation rootProject.ext.supportLibDependencies.constraintLayout
    implementation projectOrAar(rootProject.ext.libraries.remoteResourceRequest)

    implementation(rootProject.ext.tkpdLibDependencies.expandableOption) {
        exclude group: "com.android.support"
    }
    implementation(rootProject.ext.tkpdLibDependencies.showcase) {
        exclude group: "com.android.support"
    }
    implementation(rootProject.ext.analyticsDependencies.branch) {
        exclude module: 'answers-shim'
    }
    implementation rootProject.ext.supportLibDependencies.preferenceV7
    implementation rootProject.ext.supportLibDependencies.mediaV7
    implementation rootProject.ext.dbDependencies.dbRoomRuntime
    implementation rootProject.ext.miscDependencies.coroutineCore
    implementation rootProject.ext.miscDependencies.coroutineAndroid
    implementation rootProject.ext.miscDependencies.chips
    implementation rootProject.ext.miscDependencies.gson
    implementation rootProject.ext.miscDependencies.rxAndroid
    implementation rootProject.ext.miscDependencies.rxJava
    compileOnly rootProject.ext.miscDependencies.javaxAnnotation
    implementation rootProject.ext.miscDependencies.dagger
    annotationProcessor rootProject.ext.miscDependencies.daggerCompiler
    implementation projectOrAar(rootProject.ext.libraries.analyticAnnotationCentral)
    implementation(rootProject.ext.debugToolsDependencies.timber) {
        exclude group: 'org.jetbrains', module: 'annotations'
    }

    //[START] test and androidTest dependencies
    androidTestImplementation(rootProject.ext.testDependencies.espressoCore, {
        exclude group: 'com.android.support', module: 'support-annotations'
    })
    testImplementation rootProject.ext.testDependencies.junit
    testImplementation rootProject.ext.testDependencies.mockitorCore
    testImplementation rootProject.ext.miscDependencies.rxJava
    androidTestImplementation rootProject.ext.miscDependencies.rxJava
    androidTestImplementation rootProject.ext.testDependencies.spoon
    androidTestImplementation rootProject.ext.testDependencies.androidAnnotation
    androidTestImplementation(rootProject.ext.testDependencies.espressoCore, {
        exclude group: 'com.android.support', module: 'support-annotations'
    })
    androidTestImplementation(rootProject.ext.testDependencies.androidTestRunner) {
        exclude module: 'support-annotations'
    }
    androidTestImplementation(rootProject.ext.testDependencies.androidRulesVersion) {
        exclude module: 'support-annotations'
    }
    androidTestImplementation(rootProject.ext.testDependencies.espressoIntents) {
        exclude group: 'com.android.support', module: 'support-annotations'
    }
    androidTestImplementation(rootProject.ext.testDependencies.espressoContrib, {
        exclude group: 'com.android.support', module: 'support-annotations'
    })
    androidTestImplementation rootProject.ext.testDependencies.retrofitMock
    androidTestImplementation rootProject.ext.testDependencies.retrofitMockWebserver
    androidTestAnnotationProcessor rootProject.ext.miscDependencies.daggerCompiler
    androidTestImplementation rootProject.ext.miscDependencies.dagger
    androidTestImplementation rootProject.ext.miscDependencies.gson
    // Cloud testing
    androidTestImplementation(name: 'cloudtestingscreenshotter_lib', ext: 'aar')
    androidTestImplementation rootProject.ext.supportLibDependencies.appCompactV7
    androidTestImplementation rootProject.ext.supportLibDependencies.cardViewV7

    // UI Test
    androidTestImplementation rootProject.ext.testDependencies.androidTestRunner
    androidTestImplementation rootProject.ext.testDependencies.androidRulesVersion
    androidTestImplementation rootProject.ext.testDependencies.junit
    androidTestImplementation rootProject.ext.testDependencies.mockkAndroid
    androidTestImplementation rootProject.ext.testDependencies.espressoCore
    androidTestImplementation rootProject.ext.testDependencies.espressoContrib
    androidTestImplementation projectOrAar(rootProject.ext.libraries.instrumentation_test)
    androidTestAnnotationProcessor rootProject.ext.miscDependencies.daggerCompiler
    androidTestImplementation rootProject.ext.testDependencies.archCoreTesting
    androidTestImplementation rootProject.ext.testDependencies.benchmark
    androidTestImplementation rootProject.ext.testDependencies.testCore
    androidTestImplementation projectOrAar(rootProject.ext.features.contentTest)

    androidTestImplementation rootProject.ext.testDependencies.fragmentTest
}
